appTodos.controller('aboutController', function ($scope, $localStorage) {
    $scope.message = 'About page Everyone come and see how good i look!';
});
appTodos.controller('contactController', function ($scope) {
    $scope.message = 'Contact Everyone come and see how good i look!';
});
appTodos.controller('homeController', function ($scope) {
    $scope.message = 'Everyone come and see how good i look!';
});
appTodos.controller('loginController', function ($rootScope, $scope, $location, $localStorage, Users, SweetAlert) {
    $scope.message = 'Login Everyone come and see how good i look!';
    $scope.users = {};

    $scope.login = function () {
        if ($scope.loginForm.$valid) {
            Users.login($scope.user).then(function (data) {
                if (data.result == true) {
                    $localStorage.isAuthenticated = true;
                    $localStorage.userRole = data.role;
                    $localStorage.userId = data.id;
                    SweetAlert.swal("You are successfully logged in.", "", "success");
                    $location.path('/');
                } else if (data.result == false) {
                    SweetAlert.swal(data.message, "", "error");
                }
            });
        }
    };

    $scope.reset = function (form) {
        if (form) {
            form.$setPristine();
            form.$setUntouched();
        }
        $scope.user = {};
    };

});
appTodos.controller('MainController', function ($scope, $localStorage, accessFactory) {
    $scope.isAuthenticated = $localStorage.isAuthenticated;

    $scope.checkIfVisible = function(url) {
        return accessFactory.checkPermission(url);
    };
});
appTodos.controller('registrationController', function ($scope, $location, Users, SweetAlert) {
    $scope.users = {};

    $scope.register = function () {
        if ($scope.registerForm.$valid) {
            var count = 0;
            Users.get(null, 'email=' + $scope.user.email).then(function (data) {
                count = data.length;
                if (count == 0) {
                    Users.post($scope.user).then(function (data) {
                        SweetAlert.swal("User successfully created", "", "success");
                        $location.path('/login');
                    });
                } else {
                    SweetAlert.swal("User with same E-mail already exists", "", "error");
                }
            });
        }
    };

    $scope.reset = function (form) {
        if (form) {
            form.$setPristine();
            form.$setUntouched();
        }
        $scope.user = {};
    };
});
appTodos.controller('TodosController', function ($scope, $localStorage) {
    $scope.message = 'Todos page Everyone come and see how good i look!';
});
appTodos.controller('UsersController', function ($scope, $location, Users, ngDialog, SweetAlert) {
    $scope.users = {};
    $scope.user = {};

    $scope.reload = function () {
        Users.get().then(function (data) {
            $scope.users = angular.fromJson(data);
        });
    };

    $scope.editModalOpen = function (userId) {
        Users.get(userId).then(function (data) {
            $scope.user = data[0];
            ngDialog.open({
                template: 'pages/users/edit.html',
                scope: $scope,
                controller: function ($scope) {
                    $scope.saveEdited = function () {
                        if ($scope.editUserForm.$valid) {
                            if ($scope.user.password == $scope.user.password_confirm) {
                                delete $scope.user.password_confirm;
                                Users.put($scope.user._id, $scope.user).then(function (data) {
                                    SweetAlert.swal("User successfully updated", "", "success");
                                    $scope.reload();
                                    ngDialog.closeAll();
                                });
                            }
                        }
                    }
                }
            });
        });
    };

    $scope.remove = function (userId) {
        SweetAlert.swal({
            title: 'Are You sure You want remove this user?',
            text: '',
            type: 'warning',
            showCancelButton: true,
            confirmButtonText: 'Confirm',
            cancelButtonText: 'Cancel',
            confirmButtonClass: 'btn btn-success',
            cancelButtonClass: 'btn btn-danger'
        }, function (isConfirmed) {
            if (isConfirmed) {
                Users.get(userId).then(function (data) {
                    alert('1111');
                    //SweetAlert.swal({title: "User successfully removed", text: "", type: "success"});
                });
            }
        });
    };

    $scope.reload();
});